

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Error Handling &mdash; Sensirion I²C Python Driver 0.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Logging / Debugging" href="logging_debugging.html" />
    <link rel="prev" title="Single/Multi-Channel Mode" href="single_multi_channel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Sensirion I²C Python Driver
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="transceivers.html">Transceivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="single_multi_channel.html">Single/Multi-Channel Mode</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Error Handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#single-channel-error-handling">Single Channel Error Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-channel-error-handling">Multi Channel Error Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="logging_debugging.html">Logging / Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Sensirion I²C Python Driver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Error Handling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/error_handling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="error-handling">
<h1>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h1>
<p>This page gives you an overview how and which errors are handled by the driver,
and how the user has to implement error handling. Since it is heavily related
to the <a class="reference internal" href="single_multi_channel.html#single-multi-channel-mode"><span class="std std-ref">Single/Multi-Channel Mode</span></a>, you should read that documentation
first.</p>
<p>The following errors can occur when executing I²C commands:</p>
<ul class="simple">
<li>Slave didn’t acknowledge the data from the master (NACK): In this case,
you’ll get an <a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cTransceiveError" title="sensirion_i2c_driver.errors.I2cTransceiveError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cTransceiveError</span></code></a>,
or its derived (i.e. more specific) error
<a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cNackError" title="sensirion_i2c_driver.errors.I2cNackError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cNackError</span></code></a>. It depends on the
capabilities of the underlying I²C transceiver which error you’ll get.</li>
<li>Slave stretched the clock line longer than expected (clock stretching
timeout): Similar to the NACK error, you’ll get an
<a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cTransceiveError" title="sensirion_i2c_driver.errors.I2cTransceiveError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cTransceiveError</span></code></a>,
or its derived error <a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cTimeoutError" title="sensirion_i2c_driver.errors.I2cTimeoutError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cTimeoutError</span></code></a>.</li>
<li>On multi channel I²C transceivers, it’s possible that some specific I²C
channels are simply disabled, i.e. no I²C commands will be executed on these
channels. Such channels will return the error
<a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cChannelDisabledError" title="sensirion_i2c_driver.errors.I2cChannelDisabledError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cChannelDisabledError</span></code></a>.</li>
<li>If the response of the executed I²C command contains CRCs (like
<a class="reference internal" href="api.html#sensirion_i2c_driver.sensirion_command.SensirionI2cCommand" title="sensirion_i2c_driver.sensirion_command.SensirionI2cCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">SensirionI2cCommand</span></code></a>),
you’ll get an <a class="reference internal" href="api.html#sensirion_i2c_driver.errors.I2cChecksumError" title="sensirion_i2c_driver.errors.I2cChecksumError"><code class="xref py py-class docutils literal notranslate"><span class="pre">I2cChecksumError</span></code></a> if
at least one received CRC was wrong.</li>
<li>The <a class="reference internal" href="api.html#sensirion_i2c_driver.command.I2cCommand.interpret_response" title="sensirion_i2c_driver.command.I2cCommand.interpret_response"><code class="xref py py-meth docutils literal notranslate"><span class="pre">interpret_response()</span></code></a>
method of executed commands might even raise any other exception which is
then forwarded to you like any other error described above.</li>
<li>If the execution of I²C commands by the underlying transceiver completely
failes, the transceiver might raise a transceiver specific exception which
will not be handled by this driver at all. So it will propagate directly up
into the user code.</li>
</ul>
<div class="section" id="single-channel-error-handling">
<h2>Single Channel Error Handling<a class="headerlink" href="#single-channel-error-handling" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="single_multi_channel.html#single-channel-mode"><span class="std std-ref">Single Channel</span></a> mode, you can handle errors just the usual way
with <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">except</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sensirion_i2c_driver</span> <span class="kn">import</span> <span class="n">LinuxI2cTransceiver</span><span class="p">,</span> <span class="n">I2cConnection</span><span class="p">,</span> \
    <span class="n">I2cDevice</span><span class="p">,</span> <span class="n">I2cCommand</span>
<span class="kn">from</span> <span class="nn">sensirion_i2c_driver.errors</span> <span class="kn">import</span> <span class="n">I2cNackError</span><span class="p">,</span> <span class="n">I2cChecksumError</span>


<span class="k">class</span> <span class="nc">MyI2cDevice</span><span class="p">(</span><span class="n">I2cDevice</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyI2cDevice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">slave_address</span><span class="o">=</span><span class="mh">0x69</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">I2cCommand</span><span class="p">(</span><span class="n">tx_data</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x80\x04</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rx_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                       <span class="n">read_delay</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="k">with</span> <span class="n">LinuxI2cTransceiver</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">transceiver</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">I2cConnection</span><span class="p">(</span><span class="n">transceiver</span><span class="p">)</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">MyI2cDevice</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

    <span class="c1"># Handle any error the same way</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Response: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

    <span class="c1"># Handle NACK and CRC errors separately</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Response: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">I2cNackError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Slave did not acknowledge!&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">I2cChecksumError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Received wrong CRC!&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-channel-error-handling">
<h2>Multi Channel Error Handling<a class="headerlink" href="#multi-channel-error-handling" title="Permalink to this headline">¶</a></h2>
<p>In <a class="reference internal" href="single_multi_channel.html#multi-channel-mode"><span class="std std-ref">Multi Channel</span></a> mode, error handling is slighly more complicated
since exceptions are not raised, but returned as items within the list of
responses.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sensirion_i2c_driver</span> <span class="kn">import</span> <span class="n">LinuxI2cTransceiver</span><span class="p">,</span> <span class="n">I2cConnection</span><span class="p">,</span> \
    <span class="n">I2cDevice</span><span class="p">,</span> <span class="n">I2cCommand</span>
<span class="kn">from</span> <span class="nn">sensirion_i2c_driver.errors</span> <span class="kn">import</span> <span class="n">I2cNackError</span><span class="p">,</span> <span class="n">I2cChecksumError</span>


<span class="k">class</span> <span class="nc">MyI2cDevice</span><span class="p">(</span><span class="n">I2cDevice</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyI2cDevice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">slave_address</span><span class="o">=</span><span class="mh">0x69</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">I2cCommand</span><span class="p">(</span><span class="n">tx_data</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x80\x04</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rx_length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                                       <span class="n">read_delay</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="k">with</span> <span class="n">LinuxI2cTransceiver</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">transceiver</span><span class="p">:</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">I2cConnection</span><span class="p">(</span><span class="n">transceiver</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">always_multi_channel_response</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Make it multi channel</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">MyI2cDevice</span><span class="p">(</span><span class="n">connection</span><span class="p">)</span>

    <span class="c1"># do_something() will always return a list, even if I²C errors occurred</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>

    <span class="c1"># Just check if none of the responses is an error</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The command failed on at least one channel!&quot;</span><span class="p">)</span>

    <span class="c1"># Print all responses</span>
    <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Response: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>

    <span class="c1"># Convert all response values (example: multiply by 2), except errors</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">responses</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="logging_debugging.html" class="btn btn-neutral float-right" title="Logging / Debugging" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="single_multi_channel.html" class="btn btn-neutral float-left" title="Single/Multi-Channel Mode" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 Sensirion AG, Switzerland

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: master
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="0.1.0/index.html">0.1.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="master/error_handling.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>